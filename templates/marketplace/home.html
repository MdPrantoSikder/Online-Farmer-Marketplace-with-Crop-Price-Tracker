{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KrishiBazar | Grocery E-commerce</title>

  <!-- Your theme -->
  <link rel="stylesheet" href="{% static 'css/freshgrocer.css' %}" />
  <script src="{% static 'js/freshgrocer.js' %}" defer></script>
</head>
<body>

  <!-- HEADER -->
  <header class="main-header">
    <a class="logo" href="{% url 'marketplace:home' %}">KrishiBazar</a>

    <form id="searchForm" class="search-container" action="{% url 'marketplace:home' %}" method="get">
      <input type="search" placeholder="Search products..." class="search-bar" name="q" value="{{ request.GET.q|default:'' }}" />
    </form>
    <button class="header-icon search-btn" type="submit" form="searchForm" style="border:none;">üîé Search</button>

    <div class="header-icons">
     <a class="header-icon" href="{% url 'marketplace:wishlist_view' %}">‚ù§ Wishlist</a>

      <a class="header-icon" href="{% url 'marketplace:view_cart' %}">üõí Cart</a>

      {% if user.is_authenticated %}
        <a class="header-icon" href="{% url 'accounts:customer_dashboard' %}">üë§ My Account</a>
        <a class="header-icon" href="{% url 'accounts:logout' %}">üö™ Logout</a>
      {% else %}
        <a class="header-icon" href="{% url 'accounts:login' %}">üîê Login</a>
        <a class="header-icon" href="{% url 'accounts:register' %}">‚ûï Register</a>
      {% endif %}
    </div>
  </header>

  <!-- NAVIGATION -->
  <nav class="navbar">
    <div class="container nav-container">
      <ul class="nav-links">
        <li><a href="{% url 'marketplace:home' %}">Home</a></li>
        <li><a href="#">Categories</a></li>
        <li><a href="#">Offers</a></li>
        <li><a href="#">Shop</a></li>
        <li><a href="{% url 'accounts:customer_dashboard' %}">Contact</a></li>
      </ul>
    </div>
  </nav>

  <!-- MAIN CONTENT GRID -->
  <section class="main-grid container">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h3>Categories</h3>
        <button class="header-icon sidebar-toggle" type="button" style="border:none; padding:6px 10px;">‚ò∞</button>
      </div>
      <ul>
        <li><a href="#">üçú Snacks & Instant</a></li>
        <li><a href="#">ü•§ Beverages</a></li>
        <li><a href="#">üç´ Chocolates</a></li>
        <li><a href="#">ü•¶ Vegetables</a></li>
        <li><a href="#">üçé Fruits</a></li>
        <li><a href="#">ü•© Meat & Fish</a></li>
        <li><a href="#">ü¶ê Sea Food</a></li>
        <li><a href="#">üçû Bakery</a></li>
      </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">

      <!-- HERO SLIDER -->
      <div class="hero-slider">
        <div class="slide active">
          <div class="hero-text">
            <span class="tagline">Fresh & Organic</span>
            <h1>Healthy Vegetables to Your Kitchen</h1>
            <p>Starting from ‡ß≥10</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-12.jpg' %}" alt="Fresh Vegetables">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Farm to Table</span>
            <h1>Fresh Fruits Delivered Daily</h1>
            <p>Discounts on all combos</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-3.jpg' %}" alt="Fresh Fruits">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">100% Natural</span>
            <h1>Healthy Groceries for You</h1>
            <p>Free delivery on first order</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-2.jpg' %}" alt="Groceries">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Daily Essentials</span>
            <h1>Fresh Meat & Seafood</h1>
            <p>Save up to 20%</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-11.jpg' %}" alt="Meat and Seafood">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Local & Organic</span>
            <h1>Support Local Farmers</h1>
            <p>Buy Fresh, Eat Healthy</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-12.jpg' %}" alt="Local Produce">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Seasonal Picks</span>
            <h1>Fruits of the Season</h1>
            <p>Special Seasonal Discounts</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-4.jpg' %}" alt="Seasonal Fruits">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Premium Quality</span>
            <h1>Best Grocery Deals</h1>
            <p>Affordable, Reliable, Fresh</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-8.jpg' %}" alt="Premium Groceries">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Express Delivery</span>
            <h1>Fast & Safe Grocery Delivery</h1>
            <p>Order Now, Delivered Today</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-9.jpg' %}" alt="Express Delivery">
          </div>
        </div>

        <div class="slide">
          <div class="hero-text">
            <span class="tagline">Exclusive Offers</span>
            <h1>Special Weekend Deals</h1>
            <p>Don't Miss Out!</p>
            <a class="btn btn-primary" href="#featured">Shop Now</a>
          </div>
          <div class="hero-image">
            <img src="{% static 'image/slider/img-10.jpg' %}" alt="Special Offers">
          </div>
        </div>

        <!-- Slider Controls -->
        <div class="slider-controls">
          <span class="prev">&#10094;</span>
          <span class="next">&#10095;</span>
        </div>
      </div>
 

<!-- FEATURED FARMERS BUTTON -->
<section class="featured-farmers">
  <h2>Meet Our Farmers</h2>
  <p>Discover the fresh and organic products grown by our farmers.</p>
  <a href="{% url 'farmers:all_farmers' %}" class="btn btn-primary">See All Farmers</a>
</section>

      <!-- POPULAR CATEGORIES -->
      <section class="popular-categories">
        <h2>Popular Categories</h2>
        <div class="category-scroll">
          <div class="category-card">Snacks</div>
          <div class="category-card">Beverages</div>
          <div class="category-card">Chocolates</div>
          <div class="category-card">Vegetables</div>
          <div class="category-card">Fruits</div>
          <div class="category-card">Meat</div>
          <div class="category-card">Seafood</div>
        </div>
      </section>

<!-- Featured Products or Latest Products Section -->
<section class="featured-products" id="latest-shelf">
  <h2 style="margin-bottom:10px;">Latest from Farmers</h2>

  <!-- Shelf wrapper -->
  <div class="shelf-wrap" style="position:relative;">
    <!-- Prev / Next -->
    <button type="button" class="shelf-nav shelf-prev" aria-label="Previous"
            style="position:absolute; left:-8px; top:50%; transform:translateY(-50%);
                   z-index:2; border:none; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.12);
                   width:36px; height:36px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center;">‚Äπ</button>
    <button type="button" class="shelf-nav shelf-next" aria-label="Next"
            style="position:absolute; right:-8px; top:50%; transform:translateY(-50%);
                   z-index:2; border:none; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.12);
                   width:36px; height:36px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center;">‚Ä∫</button>

    <!-- Viewport (scroll container) -->
    <div class="shelf-viewport"
         style="overflow-x:auto; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; padding:4px;">
      <!-- Track (horizontal flex of pages) -->
      <div class="shelf-track" style="display:flex; gap:16px;">
        {# Chunk products: 10 per page (2 rows √ó 5 cols) #}
        {% for p in products %}
          {% if forloop.first or forloop.counter0|divisibleby:10 %}
            <div class="shelf-page"
                 style="flex:0 0 100%; scroll-snap-align:start; display:grid; gap:16px;
                        grid-template-columns:repeat(5, minmax(0,1fr)); grid-auto-rows:1fr;">
          {% endif %}

              <!-- CARD -->
              <div class="product-card"
                   style="padding:12px; border-radius:12px; background:#fff;
                          box-shadow:0 2px 10px rgba(0,0,0,.06); height:100%;
                          display:flex; flex-direction:column;">
                <a href="{% url 'marketplace:product_detail' p.pk %}"
                   class="product-image"
                   style="width:100%; aspect-ratio:4/3; overflow:hidden; border-radius:10px; background:#f4f4f4; display:block;">
                  <img src="{% if p.image %}{{ p.image.url }}{% else %}{% static 'image/default-product.jpg' %}{% endif %}"
                       alt="{{ p.title }}"
                       style="width:100%; height:100%; object-fit:cover; display:block;">
                </a>

                <h3 style="font-size:1rem; margin:10px 0 4px; line-height:1.3; min-height:2.6em; overflow:hidden;">
                  {{ p.title }}
                </h3>

                <div style="color:#2e7d32; font-weight:800; font-size:1.05rem;">‡ß≥{{ p.price }}</div>
                <div style="color:#777; font-size:.85rem; margin-top:2px;">üë®‚Äçüåæ Sold by: {{ p.farmer_name }}</div>

                <div style="margin-top:auto;">
                  <div style="display:flex; gap:8px; justify-content:center; margin-top:10px; flex-wrap:wrap;">
                    <a class="btn btn-secondary" href="{% url 'marketplace:product_detail' p.pk %}">View</a>

                    <!-- Add to Wishlist -->
                    <form action="{% url 'marketplace:add_to_wishlist' p.pk %}" method="post" style="margin:0;">
                      {% csrf_token %}
                      <button class="btn btn-warning" type="submit">‚ù§ Wishlist</button>
                    </form>

                    <!-- Remove from Wishlist -->
                    <form action="{% url 'marketplace:remove_from_wishlist' p.pk %}" method="post" style="margin:0;">
                      {% csrf_token %}
                      <button class="btn btn-danger" type="submit">Remove</button>
                    </form>
                  </div>
                </div>
              </div>
              <!-- /CARD -->

          {% if forloop.last or forloop.counter|divisibleby:10 %}
            </div>
          {% endif %}
        {% empty %}
          <div class="shelf-page"
               style="flex:0 0 100%; scroll-snap-align:start; display:grid; gap:16px;
                      grid-template-columns:repeat(5, minmax(0,1fr)); grid-auto-rows:1fr;">
            <div class="text-product" style="grid-column:1/-1; text-align:center; padding:18px; background:#fafafa; border-radius:10px;">
              No products yet ‚Äî be the first to list!
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Responsive tune: keep 5 cols on desktop, relax on smaller screens -->
      </section>



      <!-- OFFERS -->
      <section class="offers">
        <h2>Upcoming Offers</h2>
        <div class="offer-cards">
          <div class="offer-card orange">Fresh Fruit -20%</div>
          <div class="offer-card yellow">Chicken Sale -15%</div>
          <div class="offer-card blue">Accessories -10%</div>
        </div>
      </section>

      <!-- EXTENDED OFFERS -->
      <section class="extended-offers">
        <div class="product-listing-grid">
          <div class="text-product">
            <img src="{% static 'image/product/big-3.jpg' %}" alt="Minced Meat" class="product-thumb"> Minced meat pack, beef, mutton, and chicken
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-15.jpg' %}" alt="Raw Chicken" class="product-thumb"> Raw Chicken cut & clean 500g
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-14.jpg' %}" alt="Pork Slices" class="product-thumb"> Premium Pork Slices
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-13.jpg' %}" alt="Beef Steak" class="product-thumb"> Raw Beef Steak Sliced
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-12.jpg' %}" alt="Boneless Chicken Breast" class="product-thumb"> Raw Boneless Chicken Breast
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-11.jpg' %}" alt="Seafood Box" class="product-thumb"> Seafood Value Box
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-10.jpg' %}" alt="Meat Kebab" class="product-thumb"> Raw Meat Kebab
          </div>
          <div class="text-product">
            <img src="{% static 'image/product/img-9.jpg' %}" alt="Fish Fillet" class="product-thumb"> Frozen Fish Fillet 500g
          </div>
        </div>
      </section>

      <!-- FEATURED + COMBOS -->
      <section class="featured-products">
        <h2>Featured Products</h2>
        <div class="product-grid">
          <div class="product-card">
            <div class="product-image"><img src="{% static 'image/product/img-5.jpg' %}" alt="Raw Chicken"></div>
            <h3>Raw Chicken</h3><p>‡ß≥499</p>
          </div>
          <div class="product-card">
            <div class="product-image"><img src="{% static 'image/product/img-6.jpg' %}" alt="Jumbo Shrimp"></div>
            <h3>Jumbo Shrimp</h3><p>‡ß≥699</p>
          </div>
          <div class="product-card">
            <div class="product-image"><img src="{% static 'image/product/img-7.jpg' %}" alt="Organic Black Raisins"></div>
            <h3>Organic Black Raisins</h3><p>‡ß≥349</p>
          </div>
          <div class="product-card">
            <div class="product-image"><img src="{% static 'image/product/img-8.jpg' %}" alt="Fresh Spinach"></div>
            <h3>Fresh Spinach</h3><p>‡ß≥199</p>
          </div>
        </div>

        <div class="combo-offers">
          <div class="combo-card yellow">
            <h3>Organic Fruits</h3>
            <p>Combo Offer: ‡ß≥1199</p>
            <a class="btn btn-primary" href="#">Shop Now</a>
          </div>
          <div class="combo-card green">
            <h3>Vegetables</h3>
            <p>Combo Offer: ‡ß≥1299</p>
            <a class="btn btn-primary" href="#">Shop Now</a>
          </div>
        </div>

        <div class="promo-banner pink">
          <h3>Super Discount on First Purchase</h3>
          <a class="btn btn-secondary" href="#">Shop Now</a>
        </div>
      </section>

      <!-- TESTIMONIALS -->
      <section class="testimonials container">
        <h2>Love from Customers</h2>
        <div class="testimonial-grid">
          <div class="testimonial"><p>‚ÄúThe freshest groceries delivered fast!‚Äù</p><strong>- Beatrix Cooper</strong></div>
          <div class="testimonial"><p>‚ÄúGreat service and reasonable pricing.‚Äù</p><strong>- Kathryn Murphy</strong></div>
          <div class="testimonial"><p>‚ÄúMy go-to store for weekly groceries.‚Äù</p><strong>- Jenny Wilson</strong></div>
          <div class="testimonial"><p>‚ÄúLoved the organic collection. 5 stars!‚Äù</p><strong>- Robert Fox</strong></div>
        </div>
      </section>

    </div><!-- /main-content -->
  </section><!-- /main-grid -->

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer-container">
      <p>&copy; {% now "Y" %} KrishiBazar. All rights reserved.</p>
      <ul class="footer-links">
        <li><a href="#">Privacy</a></li>
        <li><a href="#">Terms</a></li>
        <li><a href="#">Support</a></li>
      </ul>
    </div>
  </footer>
<script>
  // Automatically fetch products when the page loads
  document.addEventListener("DOMContentLoaded", function() {
    fetchProducts();

  });
</script>
 <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Extract CSRF token from the cookie
      const csrfToken = document.cookie.match(/csrftoken=([\w-]+)/)[1];

      // DELETE request to delete product with id 5
      fetch('http://127.0.0.1:8000/api/products/5/', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrfToken, // CSRF token in the header
        },
      })
      .then(response => response.json())
      .then(data => console.log('Product deleted:', data))
      .catch(error => console.error('Error deleting product:', error));
    });
  </script>

  <script>
    (function () {
      const shelf = document.getElementById('latest-shelf');
      if (!shelf) return;

      const viewport = shelf.querySelector('.shelf-viewport');
      const track    = shelf.querySelector('.shelf-track');
      const pages    = Array.from(track.querySelectorAll('.shelf-page'));
      const prevBtn  = shelf.querySelector('.shelf-prev');
      const nextBtn  = shelf.querySelector('.shelf-next');

      if (!pages.length) {
        prevBtn && (prevBtn.style.display = 'none');
        nextBtn && (nextBtn.style.display = 'none');
        return;
      }

      // Snap to the nearest page after any scroll
      function snapToNearest() {
        const x = viewport.scrollLeft;
        // find page whose left is closest to current scroll
        let closest = pages[0], best = Infinity;
        pages.forEach(p => {
          const left = p.offsetLeft;
          const d = Math.abs(left - x);
          if (d < best) { best = d; closest = p; }
        });
        viewport.scrollTo({ left: closest.offsetLeft, behavior: 'smooth' });
        updateArrows();
      }

      function pageIndex() {
        const x = viewport.scrollLeft + 1; // +1 to avoid rounding edge
        let idx = 0;
        for (let i = 0; i < pages.length; i++) {
          if (pages[i].offsetLeft <= x) idx = i;
        }
        return idx;
      }

      function go(delta) {
        let idx = pageIndex() + delta;
        idx = Math.max(0, Math.min(pages.length - 1, idx));
        viewport.scrollTo({ left: pages[idx].offsetLeft, behavior: 'smooth' });
        setTimeout(updateArrows, 300);
      }

      function updateArrows() {
        const idx = pageIndex();
        if (prevBtn) prevBtn.disabled = (idx === 0);
        if (nextBtn) nextBtn.disabled = (idx === pages.length - 1);
      }

      prevBtn && prevBtn.addEventListener('click', () => go(-1));
      nextBtn && nextBtn.addEventListener('click', () => go(+1));
      viewport.addEventListener('scrollend' in window ? 'scrollend' : 'scroll', () => {
        // Debounce snapping after manual scrolls; only snap once user stops
        clearTimeout(viewport._snapTimer);
        viewport._snapTimer = setTimeout(snapToNearest, 120);
      });

      // init
      updateArrows();
      // ensure first page aligned on load
      viewport.scrollTo({ left: pages[0].offsetLeft, behavior: 'instant' });
    })();
  </script>
</body>
</html>
